<app-page-toolbar username="Martin Pultz"
                  (logout)="onLogout()"></app-page-toolbar>

<app-busy-overlay [busy]="busy">

  <div class="container">
    <div class="row">
      <div class="col col-lg-8 introduction">

        <app-page-header [title]="title">
          <ng-container appPageHeaderSummary>
            Use this page to generate a certificate you can use when you need to provide proof of vaccination or
            negative test results. These will be stored in a digital wallet on your personal device (e.g. phone or
            tablet). You can choose which records you include in your credential.
          </ng-container>
        </app-page-header>

      </div>
    </div>
    <div class="row">
      <div class="col">

        <button mat-stroked-button
                class="mb-4"
                (click)="addAllImmunizationRecords()">
          <mat-icon color="primary">add</mat-icon> Add All Records
        </button>

      </div>
    </div>
    <div class="row">
      <div class="col-12 col-md-9 col-lg-7 col-xl-6">

        <ng-container *ngFor="let record of immunizationRecords">

          <app-card-alert icon="coronavirus"
                          subtitle="Immunization Record"
                          [title]="record.vaccine.disease"
                          [alertOptions]="getAlertOptions(record)"
                          (selected)="addSelectedImmunizationRecord(record)">
            <mat-card-content>
              <mat-list dense>
                <mat-list-item>
                  <h3 matLine>Manufacturer</h3>
                  <p matLine>{{ record.vaccine.manufacturer }}</p>
                </mat-list-item>
                <mat-list-item>
                  <h3 matLine>Date of Administration</h3>
                  <p matLine>{{ record.dateOfVaccination | formatDate: 'MMMM DD, YYYY' }}</p>
                </mat-list-item>
              </mat-list>

              <app-card-action-expansion [immunizationRecord]="record"></app-card-action-expansion>
            </mat-card-content>

            <button mat-flat-button
                    color="primary">
              Add to Wallet
            </button>
          </app-card-alert>

        </ng-container>

      </div>
      <div class="col-12 col-md-9 col-lg-4">
        <div class="sticky-top">

          <mat-card class="temporary">
            <mat-card-subtitle>Verifiable Credential</mat-card-subtitle>
            <mat-card-title>Immunization Records</mat-card-title>
            <mat-card-content>

              <ng-container *ngIf="selectedImmunizationRecords.length; else noSelectedImmunizationRecords">

                <p class="summary">
                  List of immunization records that you've selected to be added to your digial wallet:
                </p>

                <mat-list dense>
                  <mat-divider></mat-divider>
                  <ng-container *ngFor="let record of selectedImmunizationRecords">
                    <mat-list-item>
                      <p matLine>{{ record.vaccine.disease }}</p>
                      <button mat-icon-button
                              (click)="removeSelectedImmunizationRecord(record.id)">
                        <mat-icon>close</mat-icon>
                      </button>
                    </mat-list-item>
                    <mat-divider></mat-divider>
                  </ng-container>
                </mat-list>

                <p class="mt-3">
                  By clicking <strong>Save to Wallet</strong> you will create a Verifiable Credential with the
                  listed
                  immunization records.
                </p>

              </ng-container>

              <ng-template #noSelectedImmunizationRecords>
                <div class="cart-icon">
                  <mat-icon>tap_and_play</mat-icon>
                </div>
                <p class="no-selection">
                  No immunization records selected for your digital wallet.
                </p>
              </ng-template>

            </mat-card-content>

            <mat-card-actions *ngIf="selectedImmunizationRecords.length"
                              class="p-3">
              <button mat-flat-button
                      color="primary"
                      class="w-100"
                      (click)="onCreateCredential()">Save to Wallet</button>
            </mat-card-actions>

            <ng-container *ngIf="issuedCredential">
              <mat-divider></mat-divider>

              <p>
                Scan this QR code with your phone to add your digital health certificate to your digital wallet. You
                will only scan this code once.
              </p>

              <app-qrcode [base64QRCode]="issuedCredential"></app-qrcode>
            </ng-container>
          </mat-card>

        </div>
      </div>
    </div>
  </div>

</app-busy-overlay>

<app-page-footer></app-page-footer>
